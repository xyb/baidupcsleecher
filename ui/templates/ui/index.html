{% extends "ui/base.html" %}

{% block nav %}
  <a href="/ui/">UI</a>
{% endblock %}

{% block content %}
  <div class="flex justify-between">
    <h1 class="text-2xl font-bold mb-4">Leecher</h1>

    <!-- switch dark mode -->
    <div class="relative inline-block">
      <a id='darklink' class="hs-dark-mode-active:hidden block hs-dark-mode group flex items-center text-gray-600 hover:text-blue-600 font-medium dark:text-gray-400 dark:hover:text-gray-500" href="#!" data-hs-theme-click-value="dark">
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"/>
        </svg>
      </a>
      <a id='lightlink' class="hs-dark-mode-active:block hidden hs-dark-mode group flex items-center text-gray-600 hover:text-blue-600 font-medium dark:text-gray-400 dark:hover:text-gray-500" href="#!" data-hs-theme-click-value="light">
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
      </a>
    </div>
  </div>

{% comment %}
<!-- add task -->
<form class="mb-4">
  <div class="flex flex-col md:flex-row mb-2">
    <input type="text" class="w-full md:w-1/2 px-4 py-2 border rounded-l-md rounded-t-md focus:outline-none"
      placeholder="Input the share link to download / 输入下载链接">
    <button type="submit"
      class="w-full md:w-1/2 bg-blue-500 text-white px-4 py-2 rounded-r-md rounded-t-md focus:outline-none hover:bg-blue-600 transition duration-200">
      Add Task / 添加下载任务
    </button>
  </div>
</form>
{% endcomment %}

{% comment %}
<!-- search -->
<input type="text" class="w-full px-4 py-2 mb-4 border rounded-md focus:outline-none"
  placeholder="Search Link / 搜索下载任务">
{% endcomment %}

  <!-- tasks -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

    {% for task in page %}
      <div class="bg-white dark:bg-gray-800 dark:text-gray-300 p-6 rounded-lg shadow-lg">
        <!-- task status -->
        <div class="flex items-baseline">
          {% if task.done %}
            <div
              class="bg-green-200 dark:bg-green-600 text-teal-800 dark:text-teal-900 text-xs px-2 inline-block rounded-full uppercase font-semibold tracking-wide">
              Done
            </div>
          {% elif task.failed %}
            <div
              class="bg-red-200 dark:bg-red-600 text-teal-800 dark:text-teal-900 text-xs px-2 inline-block rounded-full uppercase font-semibold tracking-wide">
              {{ task.current_step }}
            </div>
          {% else %}
            <div
              class="bg-teal-200 dark:bg-teal-600 text-teal-800 dark:text-teal-900 text-xs px-2 inline-block rounded-full uppercase font-semibold tracking-wide">
              {{ task.status }}
            </div>
          {% endif %}

          <div class="ml-2 text-gray-600 dark:text-gray-500 uppercase text-xs font-semibold tracking-wider">
            {{ task.created_at | timesince }}
          </div>
        </div>

        <!-- the largest file -->
        <div class="mt-1 text-gray-600 dark:text-gray-500 5ext-xl truncate text-center">
          <span class="text-base">
            {{ task.largest_file | default:"[waiting for file list]" }}
          </span>
          <span class="text-xs">
            {{ task.largest_file_size | filesizeformat }}
          </span>
        </div>

        <!-- summary -->
        <div class="grid grid-cols-2 my-2 justify-items-center gap-4">
          <div class="text-center">
            <div class="text-xl text-sky-500 dark:text-sky-700">Files</div>
            <div class="font-mono text-3xl text-gray-600 dark:text-gray-500">{{ task.total_files }}</div>
          </div>
          <div class="text-center">
            <div class="text-xl text-sky-500 dark:text-sky-700">Size</div>
            <div class="font-mono text-3xl text-gray-600 dark:text-gray-500">{{ task.total_size | filesizeformat }}</div>
          </div>
        </div>

        <!-- percentage -->
        {% comment %}
        {% if task.is_downloading %}
        {% widthratio task.local_files|length task.total_files 100 %}%
        {% endcomment %}
        <div>
          <div class="h-3 relative max-w-xl rounded-full overflow-hidden">
            <div class="w-full h-full bg-gray-200 dark:bg-gray-500 absolute"></div>
            <div class="h-full bg-green-400 dark:bg-green-700 absolute" style="width:{% widthratio task.local_size task.total_size 100 %}%">
            </div>
          </div>
        </div>

        <div class="flex mt-4 text-right">
          <!-- shared id and password -->
          <div class="flex-auto flex items-left mt-1 inline-block text-gray-200 dark:text-gray-700 text-xs font-semibold truncate">
            <span class="truncate">
              {{ task.shared_id }}
            </span>
            {% if task.shared_password %}
              /
              <span>
                {{ task.shared_password }}
              </span>
            {% endif %}
          </div>

          <!-- status of every steps -->
          <div class="flex items-right">
            <svg class="h-6 w-6 {{ task.transfer_completed_at | yesno:" text-green-500 dark:text-green-800, text-stone-400 dark:text-stone-600" }} inline"
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                 stroke-linejoin="round">
              <circle cx="5.5" cy="11.5" r="4.5" />
              <circle cx="18.5" cy="11.5" r="4.5" />
              <line x1="5.5" y1="16" x2="18.5" y2="16" />
            </svg>
            <svg class="h-6 w-6 {{ task.sample_downloaded_at | yesno:" text-green-500 dark:text-green-800, text-stone-400 dark:text-stone-600" }} inline" width="24"
                 height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                 stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" />
              <path d="M9 5H7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2V7a2 2 0 0 0 -2 -2h-2" />
              <rect x="9" y="3" width="6" height="4" rx="2" />
              <line x1="9" y1="12" x2="9.01" y2="12" />
              <line x1="13" y1="12" x2="15" y2="12" />
              <line x1="9" y1="16" x2="9.01" y2="16" />
              <line x1="13" y1="16" x2="15" y2="16" />
            </svg>
            <svg class="h-6 w-6 {{ task.full_downloaded_at | yesno:" text-green-500 dark:text-green-800, text-stone-400 dark:text-stone-600" }} inline" width="24"
                 height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                 stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" />
              <rect x="3" y="4" width="18" height="4" rx="2" />
              <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
              <line x1="10" y1="12" x2="14" y2="12" />
            </svg>
            {% if task.sample_downloaded_at %}
              <div class="text-gray-500 dark:text-gray-500">
                {% widthratio task.local_size task.total_size 100 %}%
              </div>
            {% endif %}
          </div>
        </div>

      </div>
    {% endfor %}
  </div>

<!-- pagination -->
  <div class="pagination py-6 px-4 text-center sm:p-6 md:py-10 md:px-8">
    <div class="inline-flex items-center justify-center gap-3">
      {% if page.has_previous %}
        <a href="?per_page={{ per_page }}&page=1"
           class="inline-flex h-8 w-8 items-center justify-center rounded border border-gray-100 dark:border-gray-800 bg-white dark:bg-black text-gray-900 dark:text-gray-200 rtl:rotate-180">
          <span class="sr-only">First Page</span>
          <svg class="h-6 w-6 text-gray-500" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"
               stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" />
            <polyline points="11 7 6 12 11 17" />
            <polyline points="17 7 12 12 17 17" />
          </svg>
        </a>
        <a href="?per_page={{ per_page }}&page={{ page.previous_page_number }}"
           class="inline-flex h-8 w-8 items-center justify-center rounded border border-gray-100 dark:border-gray-800 bg-white dark:bg-black text-gray-900 dark:text-gray-200 rtl:rotate-180">
          <span class="sr-only">Prev Page</span>
          <svg class="h-6 w-6 text-gray-500" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"
               stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" />
            <polyline points="15 6 9 12 15 18" />
          </svg>
        </a>
      {% endif %}

      <p class="text-xl text-gray-900 dark:text-gray-500">
        {{ page.number }} / {{ page.paginator.num_pages }} Pages
      </p>

      {% if page.has_next %}
        <a href="?per_page={{ per_page }}&page={{ page.next_page_number }}"
           class="inline-flex h-8 w-8 items-center justify-center rounded border border-gray-100 dark:border-gray-800 bg-white dark:bg-black text-gray-900 dark:text-gray-200 rtl:rotate-180">
          <span class="sr-only">Next Page</span>
          <svg class="h-6 w-6 text-gray-500" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"
               stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" />
            <polyline points="9 6 15 12 9 18" />
          </svg>
        </a>
        <a href="?per_page={{ per_page }}&page={{ page.paginator.num_pages }}"
           class="inline-flex h-8 w-8 items-center justify-center rounded border border-gray-100 dark:border-gray-800 bg-white dark:bg-black text-gray-900 dark:text-gray-200 rtl:rotate-180">
          <span class="sr-only">Last Page</span>
          <svg class="h-6 w-6 text-gray-500" width="24" height="24" viewBox="0 0 24 24" stroke-width="2"
               stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" />
            <polyline points="7 7 12 12 7 17" />
            <polyline points="13 7 18 12 13 17" />
          </svg>
        </a>
      {% endif %}
    </div>
  </div>
{% endblock %}
